<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Chart in Bio</title>
<link rel="apple-touch-icon" href="https://i.postimg.cc/kG5V5Qk4/Picsart-25-10-09-15-34-05-434.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://i.postimg.cc/kG5V5Qk4/Picsart-25-10-09-15-34-05-434.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://i.postimg.cc/kG5V5Qk4/Picsart-25-10-09-15-34-05-434.png">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/shitcoinheiros/linkbio@main/sistem.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
</head>
<body>
<header class="main-header">
<div class="header-content">
<div class="logo-section">
<a href="#" class="logo">
<div class="logo-text">Chart in Bio</div>
</a>
</div>
<div class="wallet-section">
<div class="network-selector">
<div class="network-logo" id="networkLogo">
<img src="https://assets.coingecko.com/coins/images/279/small/ethereum.png" alt="Ethereum">
</div>
<div class="network-dropdown" id="networkDropdown">
<div class="network-option active" data-chain="bsc">
<div class="network-option-icon">
<img src="https://assets.coingecko.com/coins/images/825/small/bnb-icon2_2x.png" alt="Binance Smart Chain">
</div>
<div class="network-option-name">BNB Chain</div>
</div>
<div class="network-option" data-chain="ethereum">
<div class="network-option-icon">
<img src="https://assets.coingecko.com/coins/images/279/small/ethereum.png" alt="Ethereum">
</div>
<div class="network-option-name">Ethereum</div>
</div>
<div class="network-option" data-chain="polygon">
<div class="network-option-icon">
<img src="https://assets.coingecko.com/coins/images/4713/small/matic-token-icon.png" alt="Polygon">
</div>
<div class="network-option-name">Polygon</div>
</div>
<div class="network-option" data-chain="base">
<div class="network-option-icon">
<img src="https://altcoinsbox.com/wp-content/uploads/2023/02/base-logo-in-blue.webp" alt="Base">
</div>
<div class="network-option-name">Base</div>
</div>
<div class="network-option" data-chain="avalanche">
<div class="network-option-icon">
<img src="https://assets.coingecko.com/coins/images/12559/small/Avalanche_Circle_RedWhite_Trans.png" alt="Avalanche">
</div>
<div class="network-option-name">Avalanche</div>
</div>
</div>
</div>
<span id="walletAddr" class="wallet-address">not connected</span>
<button id="connectBtn">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M13 9H21V11H13V9ZM13 13H21V15H13V13ZM13 17H21V19H13V17ZM4 19H10V21H4C2.9 21 2 20.1 2 19V5C2 3.9 2.9 3 4 3H10V5H4V19ZM7 11H9V9H7V11ZM7 15H9V13H7V15ZM7 19H9V17H7V19Z" fill="currentColor"/>
</svg>
Connect
</button>
</div>
</div>
</header>
<div class="modal" id="walletModal">
<div class="modal-content">
<div class="modal-header">
<h2 class="modal-title">Connect Wallet</h2>
<button class="close-modal" id="closeModal">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M19 6.41L17.59 8.41L18.17 11H8V13H18.17L15.59 15.58L17 17L22 12L17 7ZM4 5H12V3H4C2.9 3 2 3.9 2 5V19C2 20.1 2.9 21 4 21H12V19H4V5Z" fill="currentColor"/>
</svg>
</button>
</div>
<div class="wallet-options">
<div class="wallet-option" id="metamaskOption">
<div class="wallet-icon">
<img src="https://upload.wikimedia.org/wikipedia/commons/3/36/MetaMask_Fox.svg" alt="MetaMask">
</div>
<div class="wallet-name">MetaMask</div>
</div>
<div class="wallet-option" id="binanceOption">
<div class="wallet-icon">
<img src="https://upload.wikimedia.org/wikipedia/commons/f/fc/Binance-coin-bnb-logo.png" alt="Binance">
</div>
<div class="wallet-name">Binance Chain</div>
</div>
</div>
</div>
</div>
<main class="main-content">
<div class="card">
<div class="page-header">
<h1 class="page-title">Create / Edit Profile</h1>
<p class="page-subtitle">Manage your link identity on the blockchain</p>
</div>
<div class="mobile-network-warning" id="mobileNetworkWarning">
Change the network to Binance Smart Chain!
<br>Make sure that the network has been changed in the browser in question.
</div>
<div class="grid">
<div>
<div class="form-section">
<label for="profileType">Profile Type</label>
<select id="profileType">
<option value="personal">Personal</option>
<option value="project">Project</option>
</select>
</div>
<div class="form-section">
<label for="photo">Image (URL)</label>
<div class="small" style="margin-bottom:8px">
Add a link to your profile picture, if you don't have a link you can add it in
<a href="https://postimages.org/" target="_blank" rel="noopener noreferrer">
postimages.org
</a>
and paste the direct link
</div>
<input id="photo" type="text" placeholder="https://.../image.jpg">
</div>
<div class="form-section">
<label for="name">Name</label>
<input id="name" type="text" placeholder="Your public name (e.g., Jhon Smith)">
</div>
<div class="form-section roles-section" id="rolesSection">
<label>Position</label>
<div class="small" style="margin-bottom:8px">
Check if you hold a position in projects
</div>
<div class="roles-grid">
<label class="role-checkbox" data-role="hold">
<input type="checkbox" value="hold">
<span>HOLD</span>
</label>
<label class="role-checkbox" data-role="ceo">
<input type="checkbox" value="ceo">
<span>CEO</span>
</label>
<label class="role-checkbox" data-role="coo">
<input type="checkbox" value="coo">
<span>COO</span>
</label>
<label class="role-checkbox" data-role="cto">
<input type="checkbox" value="cto">
<span>CTO</span>
</label>
<label class="role-checkbox" data-role="cfo">
<input type="checkbox" value="cfo">
<span>CFO</span>
</label>
<label class="role-checkbox" data-role="cmo">
<input type="checkbox" value="cmo">
<span>CMO</span>
</label>
<label class="role-checkbox" data-role="kol">
<input type="checkbox" value="kol">
<span>KOL</span>
</label>
<label class="role-checkbox" data-role="dev">
<input type="checkbox" value="dev">
<span>DEV</span>
</label>
</div>
</div>
<div class="form-section">
<label for="description">Bio</label>
<textarea id="description" placeholder="Write a little about... (max. 100 characters)" maxlength="100"></textarea>
<div class="small" style="text-align:right;margin-top:4px">
<span id="charCount">0</span>/100 characters
</div>
</div>
<div class="form-section token-contract-field" id="tokenContractField">
<label for="tokenContract">Token Contract Address</label>
<input id="tokenContract" type="text" placeholder="0x...">
<div class="small" style="margin-top:4px">
Paste the contract address of your project's token
</div>
</div>
<div class="form-section" id="linksBox">
<label>Links (social network, website, etc.)</label>
<div id="linksList"></div>
<div style="margin-top:12px">
<button id="addLinkBtn" type="button" class="secondary">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M19 13H13V19H11V13H5V11H11V5H13V11H19V13Z" fill="currentColor"/>
</svg>
Add link
</button>
</div>
</div>
<div class="muted-block small desktop-text">
Customize your links page and see the changes live on the panel to the right.
</div>
<div class="actions">
<button id="saveBtn">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M17 3H5C3.89 3 3 3.9 3 5V19C3 20.1 3.89 21 5 21H19C20.1 21 21 20.1 21 19V7L17 3ZM12 19C10.34 19 9 17.66 9 16C9 14.34 10.34 13 12 13C13.66 13 15 14.34 15 16C15 17.66 13.66 19 12 19ZM15 9H5V5H15V9Z" fill="currentColor"/>
</svg>
Save to network
</button>
<button id="previewBtn" type="button" class="secondary">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12 4.5C7 4.5 2.73 7.61 1 12C2.73 16.39 7 19.5 12 19.5C17 19.5 21.27 16.39 23 12C21.27 7.61 17 4.5 12 4.5ZM12 17C9.24 17 7 14.76 7 12C7 9.24 9.24 7 12 7C14.76 7 17 9.24 17 12C17 14.76 14.76 17 12 17ZM12 9C10.34 9 9 10.34 9 12C9 13.66 10.34 15 12 15C13.66 15 15 13.66 15 12C15 10.34 13.66 9 12 9Z" fill="currentColor"/>
</svg>
View
</button>
</div>
</div>
<aside>
<div class="profile-preview" id="previewBox">
<div class="avatar">
<div class="avatar-placeholder" id="avatarPlaceholder">Add an image URL</div>
<img id="avatarImg" src="" alt="avatar" style="width:100%;height:100%;object-fit:cover;display:none">
</div>
<div style="margin-top:12px;text-align:center">
<div id="previewName" style="font-weight:700;font-size:20px">Name</div>
<div id="previewType" class="small" style="margin-top:2px;color:var(--accent-primary);font-weight:600"></div>
</div>
<div id="badgesPreview" class="badges-container" style="display:none;margin-top:8px"></div>
<div class="preview-description" id="previewDescription" style="margin-top:12px">
Your bio will appear here...
</div>
<div style="margin-top:12px;text-align:center">
<div class="small" style="font-weight:600;color:var(--text-secondary);margin-bottom:4px">Wallet:</div>
<div id="previewAddr" class="small" style="word-break:break-all;padding:8px;background:var(--bg-secondary);border-radius:var(--radius-md);font-family:monospace">endere√ßo</div>
</div>
<div id="tokenContractPreview" class="token-contract-preview" style="display:none;margin-top:12px">
<div class="small" style="font-weight:600;color:var(--text-secondary);margin-bottom:4px">Token Contract:</div>
<div id="previewTokenContract" style="word-break:break-all;padding:8px;background:var(--bg-secondary);border-radius:var(--radius-md);font-family:monospace">‚Äî</div>
</div>
<div id="tokenChartPreview" class="token-chart-preview" style="display:none;margin-top:12px">
<div class="small" style="font-weight:600;color:var(--text-secondary);margin-bottom:4px">Token Chart:</div>
<div style="padding:20px;background:var(--bg-secondary);border-radius:var(--radius-md);text-align:center;color:var(--text-muted);font-size:14px">
Token chart will appear here
</div>
</div>
<div class="links" id="previewLinks" style="margin-top:16px"></div>
</div>
<div class="muted-block small mobile-text">
Customize your page and see the changes live on the panel above.
</div>
<div style="margin-top:16px;font-size:14px;color:var(--text-secondary);font-weight:500"></div>
<div id="publicLink" class="small" style="word-break:break-all;margin-top:6px;padding:10px;background:rgba(240,185,11,0.03);border-radius:var(--radius-md);border:1px solid var(--border-light)">‚Äî</div>
</aside>
</div>
<footer>
<div class="network-info">
<div class="network-indicator"></div>
<div class="small">Chain: <span id="networkName">‚Äî</span></div>
</div>
<div class="small">Chart in Bio ‚Ä¢ Version Beta 1.0.0</div> <br>
  <div class="small">The version enabled for personal computers on mobile devices may have bugs.</div>
</footer>
</div>
</main>
<script type="module">
import { ethers } from "https://cdn.jsdelivr.net/npm/ethers@6.11.1/dist/ethers.min.js";
const NETWORKS = {bsc:{chainId:"0x38",chainName:"Binance Smart Chain",rpcUrls:["https://bsc-dataseed.binance.org/"],nativeCurrency:{name:"BNB",symbol:"BNB",decimals:18},blockExplorerUrls:["https://bscscan.com"]},ethereum:{chainId:"0x1",chainName:"Ethereum Mainnet",rpcUrls:["https://mainnet.infura.io/v3/"],nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},blockExplorerUrls:["https://etherscan.io"]},polygon:{chainId:"0x89",chainName:"Polygon Mainnet",rpcUrls:["https://polygon-rpc.com/"],nativeCurrency:{name:"MATIC",symbol:"MATIC",decimals:18},blockExplorerUrls:["https://polygonscan.com"]},base:{chainId:"0x2105",chainName:"Base Mainnet",rpcUrls:["https://mainnet.base.org/"],nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},blockExplorerUrls:["https://basescan.org"]},avalanche:{chainId:"0xA86A",chainName:"Avalanche Mainnet",rpcUrls:["https://api.avax.network/ext/bc/C/rpc"],nativeCurrency:{name:"AVAX",symbol:"AVAX",decimals:18},blockExplorerUrls:["https://snowtrace.io"]}};
const CONTRACT_ADDRESS = "0xe265ba69de5fbc462bdfad8186709e5d025225b0";
const ABI = ["function setProfile(string calldata json) external payable","function getProfile(address user) public view returns (string memory)","function setProfileFree(address user, string calldata json) external","function updateFeeReceiver(address newFeeReceiver) external","function updateFeeAmount(uint256 newFeeAmount) external","function pause() external","function resume() external","function emergencyWithdraw(address payable to, uint256 amount) external","function transferOwnership(address newOwner) external","function renounceOwnership() external","function getContractBalance() external view returns (uint256)","function hasProfile(address user) external view returns (bool)","function getContractInfo() external view returns (address, address, uint256, bool, uint256)","function calculateRefund(uint256 paidAmount) external view returns (uint256)","event ProfileUpdated(address indexed user, string json)","event FeeCollected(address indexed user, uint256 amount)","event ExcessRefunded(address indexed user, uint256 amount)","event FeeReceiverUpdated(address indexed oldReceiver, address indexed newReceiver)","event FeeAmountUpdated(uint256 oldAmount, uint256 newAmount)"];
const FEE_AMOUNT = "0.0015";
const FEE_RECEIVER = "0x4A0153E289b475Fd8693f415C00813dC77b50E64";
const connectButton = document.getElementById("connectBtn");
const walletAddressSpan = document.getElementById("walletAddr");
const nameInput = document.getElementById("name");
const descriptionInput = document.getElementById("description");
const photoInput = document.getElementById("photo");
const addLinkButton = document.getElementById("addLinkBtn");
const linksList = document.getElementById("linksList");
const previewName = document.getElementById("previewName");
const previewAddr = document.getElementById("previewAddr");
const previewDescription = document.getElementById("previewDescription");
const avatarImg = document.getElementById("avatarImg");
const previewLinks = document.getElementById("previewLinks");
const saveButton = document.getElementById("saveBtn");
const networkName = document.getElementById("networkName");
const previewButton = document.getElementById("previewBtn");
const avatarPlaceholder = document.getElementById("avatarPlaceholder");
const charCount = document.getElementById("charCount");
const walletModal = document.getElementById("walletModal");
const closeModal = document.getElementById("closeModal");
const networkLogo = document.getElementById("networkLogo");
const networkDropdown = document.getElementById("networkDropdown");
const mobileNetworkWarning = document.getElementById("mobileNetworkWarning");
const profileTypeSelect = document.getElementById("profileType");
const tokenContractField = document.getElementById("tokenContractField");
const tokenContractInput = document.getElementById("tokenContract");
const previewType = document.getElementById("previewType");
const rolesSection = document.getElementById("rolesSection");
const roleCheckboxes = document.querySelectorAll('.role-checkbox input[type="checkbox"]');
const tokenContractPreview = document.getElementById("tokenContractPreview");
const previewTokenContract = document.getElementById("previewTokenContract");
const badgesPreview = document.getElementById("badgesPreview");
const tokenChartPreview = document.getElementById("tokenChartPreview");
const AVAILABLE_ICONS = ['bi-globe','bi-twitter-x','bi-facebook','bi-instagram','bi-linkedin','bi-github','bi-discord','bi-telegram','bi-youtube','bi-tiktok','bi-reddit','bi-whatsapp','bi-envelope','bi-link-45deg','bi-share','bi-heart','bi-star','bi-bookmark','bi-flag','bi-gear','bi-house','bi-person','bi-people','bi-chat','bi-send','bi-camera','bi-image','bi-music-note','bi-film','bi-mic'];
let signer = null;
let userAddress = null;
let currentNetwork = "bsc";
const isMobileDevice = () => /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
function checkMobileNetworkWarning() {
if (isMobileDevice() && currentNetwork !== "bsc" && signer) {
mobileNetworkWarning.classList.add('show');
} else {
mobileNetworkWarning.classList.remove('show');
}
}
networkLogo.addEventListener("click", (event) => {
event.stopPropagation();
networkDropdown.classList.toggle("active");
});
document.addEventListener("click", (event) => {
if (!networkLogo.contains(event.target) && !networkDropdown.contains(event.target)) {
networkDropdown.classList.remove("active");
}
});
document.querySelectorAll(".network-option").forEach((option) => {
option.addEventListener("click", async () => {
const chain = option.getAttribute("data-chain");
document.querySelectorAll(".network-option").forEach((opt) => {
opt.classList.remove("active");
});
option.classList.add("active");
const logoImage = option.querySelector("img").src;
networkLogo.querySelector("img").src = logoImage;
networkDropdown.classList.remove("active");
if (window.ethereum && signer) {
try {
await switchNetwork(chain);
currentNetwork = chain;
updateNetworkInfo();
checkMobileNetworkWarning();
} catch (error) {
console.error("Erro ao mudar de rede:", error);
alert("Error switching to the selected network. Please check if your wallet supports this network.");
}
} else {
currentNetwork = chain;
updateNetworkInfo();
checkMobileNetworkWarning();
}
});
});
async function switchNetwork(chain) {
if (!window.ethereum) {
throw new Error("Wallet not detected");
}
const networkConfig = NETWORKS[chain];
if (!networkConfig) {
throw new Error("Network not supported");
}
try {
await window.ethereum.request({
method: "wallet_switchEthereumChain",
params: [{ chainId: networkConfig.chainId }]
});
} catch (switchError) {
if (switchError.code === 4902) {
try {
await window.ethereum.request({
method: "wallet_addEthereumChain",
params: [networkConfig]
});
} catch (addError) {
throw new Error("It was not possible to add the network to the wallet");
}
} else {
throw switchError;
}
}
}
function updateNetworkInfo() {
const networkNames = {
"bsc": "BSC",
"ethereum": "Ethereum",
"polygon": "Polygon",
"base": "Base",
"avalanche": "Avalanche"
};
networkName.textContent = networkNames[currentNetwork] || "Rede Desconhecida";
}
connectButton.onclick = () => {
if (!signer) {
walletModal.style.display = "flex";
void walletModal.offsetWidth;
} else {
disconnectWallet();
}
};
closeModal.onclick = () => {
walletModal.style.display = "none";
};
window.onclick = (event) => {
if (event.target === walletModal) {
walletModal.style.display = "none";
}
};
document.getElementById("metamaskOption").onclick = connectWallet;
document.getElementById("binanceOption").onclick = () => alert("Add chartinbio.com directly to your wallet's browser to continue.");
async function connectWallet() {
if (window.ethereum) {
try {
await window.ethereum.request({ method: "eth_requestAccounts" });
const provider = new ethers.BrowserProvider(window.ethereum);
signer = await provider.getSigner();
userAddress = await signer.getAddress();
walletAddressSpan.textContent = `${userAddress.substring(0, 6)}...${userAddress.substring(userAddress.length - 4)}`;
previewAddr.textContent = `${userAddress.substring(0, 6)}...${userAddress.substring(userAddress.length - 4)}`;
const network = await provider.getNetwork();
currentNetwork = getNetworkFromChainId(network.chainId);
updateNetworkInfo();
connectButton.innerHTML = `
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M17 7L15.59 8.41L18.17 11H8V13H18.17L15.59 15.58L17 17L22 12L17 7ZM4 5H12V3H4C2.9 3 2 3.9 2 5V19C2 20.1 2.9 21 4 21H12V19H4V5Z" fill="currentColor"/>
</svg>
Desconectar
`;
walletModal.style.display = "none";
await loadProfileOnChain(userAddress, provider);
checkMobileNetworkWarning();
} catch (error) {
console.error("Erro ao conectar:", error);
alert("Erro ao conectar carteira: " + error.message);
}
} else {
if (isMobileDevice()) {
const deepLink = `https://metamask.app.link/dapp/${window.location.host}${window.location.pathname}`;
window.location.href = deepLink;
} else {
alert("MetaMask not found. Please install MetaMask to continue.");
}
}
}
function getNetworkFromChainId(chainId) {
const chainIdHex = "0x" + chainId.toString(16);
const chainIdMap = {
"0x1": "ethereum",
"0x38": "bsc", 
"0x89": "polygon",
"0x2105": "base",
"0xA86A": "avalanche"
};
return chainIdMap[chainIdHex] || "unknown";
}
function disconnectWallet() {
signer = null;
userAddress = null;
walletAddressSpan.textContent = "not connected";
connectButton.innerHTML = `
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M13 9H21V11H13V9ZM13 13H21V15H13V13ZM13 17H21V19H13V17ZM4 19H10V21H4C2.9 21 2 20.1 2 19V5C2 3.9 2.9 3 4 3H10V5H4V19ZM7 11H9V9H7V11ZM7 15H9V13H7V15ZM7 19H9V17H7V19Z" fill="currentColor"/>
</svg>
Connect
`;
mobileNetworkWarning.classList.remove('show');
}
const getLinksData = () => Array.from(linksList.querySelectorAll(".link-item"))
.map((element) => ({ 
url: element.querySelector('.link-url-input').value,
icon: element.querySelector('.icon-selector i').className
}))
.filter((link) => link.url);
function getSelectedRoles() {
const selectedRoles = [];
roleCheckboxes.forEach(checkbox => {
if (checkbox.checked) {
selectedRoles.push(checkbox.value);
}
});
return selectedRoles;
}
function renderPreview() {
previewName.textContent = nameInput.value || "Name";
const descriptionText = descriptionInput.value || "Your description will appear here...";
previewDescription.textContent = descriptionText;
if (photoInput.value) {
avatarImg.src = photoInput.value;
avatarImg.style.display = "block";
avatarPlaceholder.style.display = "none";
} else {
avatarImg.style.display = "none";
avatarPlaceholder.style.display = "block";
}
const profileType = profileTypeSelect.value;
if (profileType === "project") {
previewType.textContent = "Projeto";
previewType.style.display = "block";
if (tokenContractInput.value) {
tokenContractPreview.style.display = "block";
tokenChartPreview.style.display = "block";
previewTokenContract.textContent = tokenContractInput.value;
} else {
tokenContractPreview.style.display = "none";
tokenChartPreview.style.display = "none";
}
badgesPreview.style.display = "none";
} else {
previewType.textContent = "Pessoal";
previewType.style.display = "block";
tokenContractPreview.style.display = "none";
tokenChartPreview.style.display = "none";
const selectedRoles = getSelectedRoles();
if (selectedRoles.length > 0) {
badgesPreview.style.display = "flex";
badgesPreview.innerHTML = "";
selectedRoles.forEach(role => {
const badge = document.createElement("div");
badge.className = `badge ${role}`;
let icon = "";
switch(role) {
case "ceo":
icon = "üëë";
break;
case "hold":
icon = "üíé";
break;
case "coo":
icon = "‚öôÔ∏è";
break;
case "cto":
icon = "üíª";
break;
case "cfo":
icon = "üí∞";
break;
case "cmo":
icon = "üì¢";
break;
case "kol":
icon = "üé•";
break;
case "dev":
icon = "üîß";
break;
}
badge.innerHTML = `${icon} ${role.toUpperCase()}`;
badgesPreview.appendChild(badge);
});
} else {
badgesPreview.style.display = "none";
}
}
previewLinks.innerHTML = "";
for (const link of getLinksData()) {
const anchor = document.createElement("a");
anchor.href = link.url;
anchor.target = "_blank";
anchor.className = "preview-link-item";
anchor.innerHTML = `
<div class="preview-link-icon">
<i class="${link.icon}"></i>
</div>
`;
previewLinks.appendChild(anchor);
}
}
function addLinkItem(url = "", icon = "bi-link-45deg") {
const div = document.createElement("div");
div.className = "link-item";
const iconSelectorContainer = document.createElement("div");
iconSelectorContainer.className = "icon-selector-container";
const iconSelector = document.createElement("div");
iconSelector.className = "icon-selector";
iconSelector.innerHTML = `<i class="${icon}"></i>`;
const iconDropdown = document.createElement("div");
iconDropdown.className = "icon-dropdown";
AVAILABLE_ICONS.forEach(iconClass => {
const iconOption = document.createElement("div");
iconOption.className = "icon-option";
iconOption.innerHTML = `<i class="${iconClass}"></i>`;
iconOption.addEventListener("click", () => {
iconSelector.innerHTML = `<i class="${iconClass}"></i>`;
iconDropdown.classList.remove("active");
renderPreview();
});
iconDropdown.appendChild(iconOption);
});
iconSelector.addEventListener("click", (event) => {
event.stopPropagation();
document.querySelectorAll('.icon-dropdown.active').forEach(dropdown => {
if (dropdown !== iconDropdown) {
dropdown.classList.remove('active');
}
});
iconDropdown.classList.toggle("active");
});
document.addEventListener("click", (event) => {
if (!iconSelectorContainer.contains(event.target)) {
iconDropdown.classList.remove("active");
}
});
iconSelectorContainer.appendChild(iconSelector);
iconSelectorContainer.appendChild(iconDropdown);
const urlInput = document.createElement("input");
urlInput.className = "link-url-input";
urlInput.placeholder = "https://...";
urlInput.value = url;
const rowDiv = document.createElement("div");
rowDiv.className = "link-item-row";
rowDiv.append(iconSelectorContainer, urlInput);
const deleteButton = document.createElement("button");
deleteButton.innerHTML = `
<svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z" fill="currentColor"/>
</svg>
Remove
`;
deleteButton.onclick = () => { div.remove(); renderPreview(); };
div.append(rowDiv, deleteButton);
linksList.appendChild(div);
urlInput.oninput = renderPreview;
renderPreview();
}
profileTypeSelect.addEventListener("change", function() {
if (this.value === "project") {
tokenContractField.classList.add("visible");
rolesSection.classList.remove("visible");
} else {
tokenContractField.classList.remove("visible");
rolesSection.classList.add("visible");
}
renderPreview();
});
roleCheckboxes.forEach(checkbox => {
checkbox.addEventListener("change", function() {
const label = this.closest('.role-checkbox');
if (this.checked) {
label.classList.add('checked');
} else {
label.classList.remove('checked');
}
renderPreview();
});
});
addLinkButton.onclick = () => addLinkItem();
addLinkItem("https://", "bi-globe");
[nameInput, descriptionInput, photoInput, tokenContractInput].forEach((element) => element.oninput = renderPreview);
descriptionInput.addEventListener("input", () => {
const count = descriptionInput.value.length;
charCount.textContent = count;
if (count > 450) {
charCount.style.color = "var(--warning)";
} else {
charCount.style.color = "var(--text-muted)";
}
if (count >= 500) {
charCount.style.color = "var(--danger)";
}
});
async function getGasPriceWithMargin(provider, marginPercent = 10) {
try {
const feeData = await provider.getFeeData();
const currentGasPrice = feeData.gasPrice;
if (!currentGasPrice) {
throw new Error("N√£o foi poss√≠vel obter o gas price");
}
const margin = BigInt(marginPercent);
const gasPriceWithMargin = currentGasPrice * (100n + margin) / 100n;
return gasPriceWithMargin;
} catch (error) {
console.error("Erro ao obter gas price:", error);
throw error;
}
}
async function saveProfileWithFee() {
if (!signer) {
walletModal.style.display = "flex";
void walletModal.offsetWidth;
return;
}
if (!nameInput.value.trim()) {
alert("Please fill in at least the profile name.");
return;
}
const profile = { 
name: nameInput.value, 
description: descriptionInput.value,
photo: photoInput.value, 
links: getLinksData(),
profileType: profileTypeSelect.value,
tokenContract: profileTypeSelect.value === "project" ? tokenContractInput.value : "",
roles: profileTypeSelect.value === "personal" ? getSelectedRoles() : [],
timestamp: new Date().toISOString()
};
try {
const userConfirmed = confirm(`üîóAll your links in one place on the blockchain.‚úÖ A single confirmation on MetaMask`);
if (!userConfirmed) {
throw new Error("Transaction canceled by the user");
}
const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
const gasPrice = await getGasPriceWithMargin(signer.provider, 15);
console.log("üöÄ Enviando transa√ß√£o √∫nica...");
const tx = await contract.setProfile(JSON.stringify(profile), {
value: ethers.parseEther(FEE_AMOUNT),
gasPrice: gasPrice
});
alert("Confirm transaction...");
const receipt = await tx.wait();
console.log("‚úÖ Transa√ß√£o confirmada:", receipt.blockNumber);
alert("üéâ Perfil salvo com sucesso! Taxa processada em uma √∫nica transa√ß√£o.");
} catch (error) { 
console.error("Error saving profile:", error);
if (error.message.includes("Insufficient balance")) {
alert(`Erro: ${error.message}\n\nPlease add BNB to your wallet and try again.`);
} else if (error.message.includes("user rejected")) {
alert("Transaction canceled by the user.");
} else if (error.message.includes("insufficient fee")) {
alert("Por favor, use o valor exato de " + FEE_AMOUNT + " BNB.");
} else {
alert("Error saving profile:" + error.message);
}
}
}
async function loadProfileOnChain(address, provider) {
const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, provider);
try {
const jsonData = await contract.getProfile(address);
if (jsonData) {
const profileObject = JSON.parse(jsonData);
nameInput.value = profileObject.name || "";
descriptionInput.value = profileObject.description || "";
photoInput.value = profileObject.photo || "";
linksList.innerHTML = "";
(profileObject.links || []).forEach((link) => addLinkItem(link.url, link.icon || "bi-link-45deg"));
if (profileObject.profileType) {
profileTypeSelect.value = profileObject.profileType;
profileTypeSelect.dispatchEvent(new Event('change'));
if (profileObject.profileType === "project" && profileObject.tokenContract) {
tokenContractInput.value = profileObject.tokenContract;
}
if (profileObject.profileType === "personal" && profileObject.roles) {
roleCheckboxes.forEach(checkbox => {
checkbox.checked = profileObject.roles.includes(checkbox.value);
const label = checkbox.closest('.role-checkbox');
if (checkbox.checked) {
label.classList.add('checked');
} else {
label.classList.remove('checked');
}
});
}
}
renderPreview();
charCount.textContent = descriptionInput.value.length;
}
} catch (error) { 
console.log("Erro ao carregar perfil:", error); 
}
}
saveButton.innerHTML = `
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M17 3H5C3.89 3 3 3.9 3 5V19C3 20.1 3.89 21 5 21H19C20.1 21 21 20.1 21 19V7L17 3ZM12 19C10.34 19 9 17.66 9 16C9 14.34 10.34 13 12 13C13.66 13 15 14.34 15 16C15 17.66 13.66 19 12 19ZM15 9H5V5H15V9Z" fill="currentColor"/>
</svg>
Save
`;
const saveButtonContainer = saveButton.parentElement;
const feeInfo = document.createElement('div');
feeInfo.className = 'small';
feeInfo.style.marginTop = '8px';
feeInfo.style.color = 'var(--text-muted)';
feeInfo.innerHTML = `Saving your link profile on the Blockchain.`;
if (saveButtonContainer) {
saveButtonContainer.appendChild(feeInfo);
}
saveButton.onclick = saveProfileWithFee;
previewButton.onclick = () => {
if (!userAddress) {
alert("Connect your wallet before opening the public page.");
walletModal.style.display = "flex";
void walletModal.offsetWidth;
return;
}
const url = `profile.html?addr=${userAddress}`;
window.open(url, "_blank");
};
renderPreview();
updateNetworkInfo();
rolesSection.classList.add("visible");
</script>
</body>
</html>
